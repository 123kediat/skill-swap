<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Skill Swap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #E31A1C; /* Reddish-Orange */
            --accent-color: #FD8D3C;  /* Medium Orange */
            --background-dark: #0d0d0d; /* Off-Black */
            --background-light: #1c1c1c; /* Dark Gray */
            --text-primary: #FFF2A8;   /* Pale Yellow */
            --text-secondary: #a0a0a0; /* Muted Gray */
        }
        html {
            height: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #2d3748; /* A neutral dark background for the page */
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Splash Screen Styles */
        #splash-screen {
            position: absolute;
            inset: 1rem; /* Match parent padding */
            background-color: #5F5458; /* Muted background from image */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.8s ease-out;
            border-radius: 30px; /* Match app container's inner radius */
        }
        .splash-logo {
            width: 100px;
            height: 100px;
            animation: rotate-in 1.5s ease-out forwards;
        }
        .splash-logo .piece {
            fill: #FFFFFF;
            transform-origin: center;
            animation: construct 1.5s ease-out forwards;
        }
        .splash-text {
            color: white;
            text-align: center;
            animation: fade-in 1s ease-in 1s forwards;
            opacity: 0;
        }
        .splash-text h1 {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 2px;
        }
        .splash-text p {
            font-size: 0.875rem;
            margin-top: 0.5rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        @keyframes rotate-in {
            from { transform: rotate(-180deg) scale(0.5); opacity: 0; }
            to { transform: rotate(0deg) scale(1); opacity: 1; }
        }
        @keyframes construct {
            0% { transform: translate(var(--tx, 0), var(--ty, 0)) scale(0); opacity: 0; }
            60% { transform: translate(0, 0) scale(1.1); opacity: 1; }
            100% { transform: translate(0, 0) scale(1); opacity: 1; }
        }
        @keyframes fade-in {
            to { opacity: 1; }
        }

        #mobile-frame {
            width: 100%;
            height: 100%;
            max-width: 414px; /* iPhone 8 Plus width */
            max-height: 896px; /* iPhone 11 Pro Max height */
            background-color: var(--background-dark);
            border-radius: 40px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            border: 8px solid #111;
        }
        #app-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            border-radius: 30px;
        }
        .page {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none;
            background-color: var(--background-dark);
            transform: translateX(100%);
        }
        .page.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(0);
        }
        .page.inactive-left {
            transform: translateX(-100%);
        }
        .page-header {
            padding: 1rem;
            background-color: var(--background-dark);
            border-bottom: 1px solid var(--background-light);
            flex-shrink: 0;
        }
        .page-content {
            flex-grow: 1;
            overflow-y: auto;
            /* Hide scrollbar */
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .page-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
        .card-stack {
            position: relative;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            position: absolute;
            width: 85%;
            height: 95%;
            border-radius: 1.5rem;
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            overflow: hidden;
            cursor: grab;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }
        .card .overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 60%);
        }
        .card-content {
            position: relative;
            z-index: 2;
            padding: 1.5rem;
        }
        .card-skill { color: var(--accent-color); }
        .nav {
            background-color: var(--background-light);
            border-top: 1px solid #333;
            flex-shrink: 0;
        }
        .nav-item.active i, .nav-item.active span { color: var(--primary-color); }

        .profile-input, .payment-input { background-color: var(--background-light); border: 1px solid #333; color: var(--text-primary); }
        .profile-input:focus, .payment-input:focus { border-color: var(--accent-color); outline: none; }
        .tag { background-color: var(--accent-color); color: var(--background-dark); }
        
        .chat-bubble { max-width: 75%; padding: 0.75rem 1rem; border-radius: 1rem; }
        .chat-bubble.sent { background-color: var(--primary-color); align-self: flex-end; color: white; }
        .chat-bubble.received { background-color: var(--background-light); align-self: flex-start; }
        .chat-bubble.ai-generated { background-color: rgba(253, 141, 60, 0.2); border: 1px solid var(--accent-color); align-self: center; width: 95%; }

        /* Premium Page Styles */
        #plan-toggle {
            position: relative;
            background-color: var(--background-light);
            border-radius: 9999px;
            padding: 0.25rem;
            display: flex;
        }
        .toggle-btn {
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: color 0.3s;
            position: relative;
            z-index: 2;
            border: none;
            background: none;
            cursor: pointer;
        }
        .toggle-btn.active {
            color: var(--background-dark);
        }
        #plan-toggle::before { /* This will be the sliding background */
            content: '';
            position: absolute;
            top: 4px;
            bottom: 4px;
            left: 4px;
            width: calc(50% - 4px);
            background-color: var(--accent-color);
            border-radius: 9999px;
            transition: transform 0.3s ease-in-out;
            z-index: 1;
        }
        #plan-toggle.yearly-active::before {
            transform: translateX(100%);
        }

        #pricing-card {
            background-color: rgba(28, 28, 28, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid var(--background-light);
            transition: all 0.3s ease-in-out;
        }
        #pricing-card.yearly-plan {
            border-color: var(--accent-color);
            box-shadow: 0 0 25px rgba(253, 141, 60, 0.3);
        }
        .badge {
            background-color: var(--accent-color);
            color: var(--background-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 1rem;
        }
        .feature-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0.5rem;
            background-color: rgba(255,255,255,0.05);
            border-radius: 0.5rem;
        }
        .feature-item i {
            color: var(--accent-color);
            width: 2rem;
            text-align: center;
        }

        /* Payment Page Styles */
        .payment-option-btn {
            background-color: var(--background-light);
            border: 1px solid #333;
            transition: all 0.2s;
        }
        .payment-option-btn.active {
            border-color: var(--accent-color);
            background-color: rgba(253, 141, 60, 0.1);
        }
        .upi-btn {
            background-color: #2a2a2a;
        }
        
        /* Gemini Feature Styles */
        .gemini-btn {
            background-color: rgba(253, 141, 60, 0.15);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }
        .gemini-btn:hover {
            background-color: rgba(253, 141, 60, 0.3);
        }
        .loading-spinner {
            border: 2px solid var(--background-light);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            width: 1.25rem;
            height: 1.25rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="mobile-frame">
        <div id="app-container">
            <!-- Home Screen -->
            <div id="home" class="page active">
                <div id="card-container" class="card-stack p-4"></div>
                <div class="flex justify-center items-center space-x-8 py-4 flex-shrink-0">
                    <button id="nope-btn" class="w-16 h-16 rounded-full bg-gray-800 shadow-lg flex items-center justify-center text-gray-500"><i class="fas fa-times fa-2x"></i></button>
                    <button id="like-btn" class="w-20 h-20 rounded-full bg-gray-800 shadow-lg flex items-center justify-center" style="color: var(--primary-color);"><i class="fas fa-thumbs-up fa-2x"></i></button>
                    <button id="message-nav-btn" class="w-16 h-16 rounded-full bg-gray-800 shadow-lg flex items-center justify-center text-yellow-300"><i class="fas fa-comment-dots fa-lg"></i></button>
                </div>
            </div>

            <!-- Connections Screen -->
            <div id="connections" class="page">
                <div class="page-header">
                    <h1 class="text-3xl font-bold" style="color: var(--text-primary);">Connections</h1>
                    <p style="color: var(--text-secondary);">Your learning network.</p>
                </div>
                <div id="connections-list" class="page-content p-0"></div>
            </div>

            <!-- Chat Screen -->
            <div id="chat" class="page">
                <div id="chat-header" class="page-header flex items-center"></div>
                <div id="chat-messages" class="page-content flex-grow p-4 space-y-4 flex flex-col"></div>
                <div id="chat-actions" class="p-2 bg-gray-900 border-t border-gray-700 flex-shrink-0">
                    <div class="flex gap-2 mb-2">
                        <button id="ai-plan-btn" class="gemini-btn flex-1 py-2 px-3 rounded-lg text-sm font-semibold flex items-center justify-center gap-2">✨ Create Learning Plan</button>
                        <button id="ai-icebreaker-btn" class="gemini-btn flex-1 py-2 px-3 rounded-lg text-sm font-semibold flex items-center justify-center gap-2">✨ Suggest Icebreaker</button>
                    </div>
                    <input type="text" placeholder="Type a message..." class="w-full bg-gray-800 p-3 rounded-lg focus:outline-none focus:ring-2" style="border-color: var(--accent-color); color: var(--text-primary);">
                </div>
            </div>

            <!-- Premium Screen -->
            <div id="premium" class="page">
                <div class="page-header text-center">
                    <i class="fas fa-rocket fa-3x" style="color: var(--accent-color);"></i>
                    <h1 class="mt-2 text-3xl font-bold" style="color: var(--text-primary);">Unlock Your Potential</h1>
                    <p style="color: var(--text-secondary);">Join Premium to accelerate your learning.</p>
                </div>
                <div class="page-content p-4">
                    <div class="flex flex-col items-center gap-8">
                        <div id="plan-toggle">
                            <button class="toggle-btn active" data-plan="monthly">Monthly</button>
                            <button class="toggle-btn" data-plan="yearly">Yearly</button>
                        </div>
                        <div id="pricing-card" class="rounded-2xl p-6 w-full max-w-sm text-center">
                            <div id="yearly-badge" class="badge hidden">BEST VALUE</div>
                            <h2 id="plan-name" class="text-2xl font-semibold" style="color: var(--text-primary);">Monthly</h2>
                            <p id="plan-price" class="mt-2 text-5xl font-bold">₹49<span class="text-gray-400 text-lg">/mo</span></p>
                            <p id="plan-strikethrough" class="text-lg text-gray-500 line-through">₹89</p>
                            <button id="subscribe-btn" class="mt-6 w-full font-bold py-3 rounded-lg hover:opacity-90 transition" style="background-color: var(--primary-color); color: white;">Subscribe Now</button>
                        </div>
                        <div class="w-full max-w-sm">
                            <h3 class="font-semibold text-center mb-4" style="color: var(--text-primary);">All Premium features include:</h3>
                            <ul id="features-list" class="space-y-3"></ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Screen -->
            <div id="payment" class="page">
                <div class="page-header flex items-center">
                    <button id="back-to-premium" class="mr-4 text-xl"><i class="fas fa-chevron-left"></i></button>
                    <div>
                        <h1 class="text-2xl font-bold" style="color: var(--text-primary);">Complete Payment</h1>
                        <p id="payment-amount" style="color: var(--text-secondary);"></p>
                    </div>
                </div>
                <div class="page-content p-4">
                    <div class="flex border-b border-gray-700 mb-4">
                        <button class="payment-option-btn active flex-1 py-3 font-semibold" data-option="upi">UPI</button>
                        <button class="payment-option-btn flex-1 py-3 font-semibold" data-option="card">Credit/Debit Card</button>
                    </div>
                    <div id="upi-options">
                        <div class="space-y-3">
                            <button class="upi-btn w-full p-4 rounded-lg flex items-center justify-between"><span>Google Pay</span> <i class="fab fa-google-pay fa-2x"></i></button>
                            <button class="upi-btn w-full p-4 rounded-lg flex items-center justify-between"><span>Paytm</span> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Paytm_Logo_%28standalone%29.svg/1200px-Paytm_Logo_%28standalone%29.svg.png" class="h-6"></button>
                            <button class="upi-btn w-full p-4 rounded-lg flex items-center justify-between"><span>Amazon Pay</span> <i class="fab fa-amazon-pay fa-2x"></i></button>
                        </div>
                    </div>
                    <div id="card-options" class="hidden">
                        <div class="space-y-4">
                            <input type="text" placeholder="Card Number" class="payment-input w-full p-3 rounded-lg">
                            <div class="flex gap-4">
                                <input type="text" placeholder="MM/YY" class="payment-input w-1/2 p-3 rounded-lg">
                                <input type="text" placeholder="CVV" class="payment-input w-1/2 p-3 rounded-lg">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-4 flex-shrink-0">
                    <button id="pay-now-btn" class="w-full font-bold py-4 rounded-lg hover:opacity-90 transition" style="background-color: var(--primary-color); color: white;">Pay Now</button>
                </div>
            </div>

            <!-- Profile Screen -->
            <div id="profile" class="page">
                <div class="page-header flex items-center justify-between">
                    <h1 class="text-3xl font-bold" style="color: var(--text-primary);">Your Profile</h1>
                    <div>
                        <button id="edit-profile-btn" class="bg-gray-700 py-2 px-4 rounded-lg hover:bg-gray-600">Edit</button>
                        <button id="save-profile-btn" class="py-2 px-4 rounded-lg hover:opacity-90 hidden" style="background-color: var(--primary-color); color: white;">Save</button>
                    </div>
                </div>
                <div class="page-content p-4">
                    <div class="bg-gray-800 p-6 rounded-2xl max-w-md mx-auto">
                        <div class="flex items-center">
                            <img id="profile-img" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=1920&auto=format&fit=crop" class="w-24 h-24 rounded-full border-4 border-gray-700">
                            <div class="ml-4 flex-1">
                                <h2 id="profile-name-view" class="text-2xl font-bold">Alex Doe</h2>
                                <input id="profile-name-edit" type="text" value="Alex Doe" class="profile-input text-2xl font-bold rounded-lg p-2 hidden w-full">
                                <p id="profile-tagline-view" style="color: var(--text-secondary);">Lifelong learner & tech enthusiast.</p>
                                <input id="profile-tagline-edit" type="text" value="Lifelong learner & tech enthusiast." class="profile-input w-full rounded-lg p-2 hidden">
                            </div>
                        </div>
                        <div class="mt-6">
                            <h3 class="font-semibold mb-2">My Skills (I can teach)</h3>
                            <div id="my-skills-view" class="flex flex-wrap gap-2"></div>
                            <input id="my-skills-edit" type="text" class="profile-input w-full rounded-lg p-2 hidden">
                        </div>
                        <div class="mt-4">
                            <h3 class="font-semibold mb-2">Skills I Want to Learn</h3>
                            <div id="learn-skills-view" class="flex flex-wrap gap-2"></div>
                            <input id="learn-skills-edit" type="text" class="profile-input w-full rounded-lg p-2 hidden">
                        </div>
                        <div class="mt-6">
                            <button id="ai-bio-btn" class="gemini-btn w-full py-2 px-3 rounded-lg text-sm font-semibold flex items-center justify-center gap-2">✨ Generate Bio</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <nav class="nav">
            <div class="flex justify-around max-w-lg mx-auto">
                <button data-page="home" class="nav-item active flex-1 text-center p-3 text-gray-400 hover:opacity-80"><i class="fas fa-home fa-lg"></i><span class="block text-xs mt-1">Home</span></button>
                <button data-page="connections" class="nav-item flex-1 text-center p-3 text-gray-400 hover:opacity-80"><i class="fas fa-users fa-lg"></i><span class="block text-xs mt-1">Connections</span></button>
                <button data-page="premium" class="nav-item flex-1 text-center p-3 text-gray-400 hover:opacity-80"><i class="fas fa-star fa-lg"></i><span class="block text-xs mt-1">Premium</span></button>
                <button data-page="profile" class="nav-item flex-1 text-center p-3 text-gray-400 hover:opacity-80"><i class="fas fa-user fa-lg"></i><span class="block text-xs mt-1">Profile</span></button>
            </div>
        </nav>
        <div id="splash-screen">
            <svg class="splash-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <g>
                    <path class="piece" style="--tx: -50px; --ty: -50px;" d="M50 0 L66 10 L50 20 L34 10 Z"></path>
                    <path class="piece" style="--tx: 50px; --ty: -50px;" d="M68 12 L82 25 L66 35 L52 22 Z"></path>
                    <path class="piece" style="--tx: 50px; --ty: 50px;" d="M50 80 L66 90 L50 100 L34 90 Z"></path>
                    <path class="piece" style="--tx: -50px; --ty: 50px;" d="M32 12 L48 22 L34 35 L18 25 Z"></path>
                    <path class="piece" style="--tx: -50px; --ty: 0;" d="M0 50 L10 34 L20 50 L10 66 Z"></path>
                    <path class="piece" style="--tx: 50px; --ty: 0;" d="M100 50 L90 66 L80 50 L90 34 Z"></path>
                </g>
            </svg>
            <div class="splash-text">
                <h1>Skill swap</h1>
                <p>Unlocking potential through shared knowledge</p>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DATA ---
    const initialProfiles = [
      { id: 1, name: 'Elena V., 28', skill: 'Advanced Python', bio: 'Software engineer with 5+ years of experience.', image: 'https://images.unsplash.com/photo-1521119989659-a83eee488004?q=80&w=1920&auto=format&fit=crop' },
      { id: 2, name: 'Marcus R., 34', skill: 'Graphic Design', bio: 'Freelance designer specializing in branding.', image: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=1920&auto=format&fit=crop' },
      { id: 3, name: 'Aisha K., 25', skill: 'Digital Marketing', bio: 'SEO & Social Media strategist.', image: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=1920&auto=format&fit=crop' },
      { id: 4, name: 'David L., 42', skill: 'Gourmet Cooking', bio: 'Former chef with a love for Italian cuisine.', image: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?q=80&w=1920&auto=format&fit=crop' },
      { id: 5, name: 'Sophia T., 29', skill: 'Mobile App Development', bio: 'React Native expert.', image: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?q=80&w=1920&auto=format&fit=crop' },
    ];
    let currentProfiles = [...initialProfiles];
    let matches = [];
    let conversations = {};
    let userProfile = {
        name: 'Alex Doe',
        tagline: 'Lifelong learner & tech enthusiast.',
        mySkills: 'JavaScript, React',
        learnSkills: 'Python, Blender, 3D Modeling'
    };
    let activePage = 'home';
    let selectedPlan = { name: 'Monthly', price: '₹49' };
    let currentChatUserId = null;

    // --- DOM ELEMENTS ---
    const splashScreen = document.getElementById('splash-screen');
    const cardContainer = document.getElementById('card-container');
    const likeBtn = document.getElementById('like-btn');
    const nopeBtn = document.getElementById('nope-btn');
    const messageNavBtn = document.getElementById('message-nav-btn');
    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page');

    // --- SPLASH SCREEN LOGIC ---
    setTimeout(() => {
        splashScreen.style.opacity = '0';
        setTimeout(() => {
            splashScreen.style.display = 'none';
        }, 800); // Match this to the transition duration
    }, 3000); // Total splash screen duration

    // --- CARD SWIPING LOGIC ---
    function createCard(profile) {
        const card = document.createElement('div');
        card.classList.add('card');
        card.style.backgroundImage = `url(${profile.image})`;
        card.innerHTML = `<div class="overlay"></div><div class="card-content"><h2 class="card-name text-white">${profile.name}</h2><p class="card-skill font-semibold">${profile.skill}</p><p class="card-bio" style="color: var(--text-secondary);">${profile.bio}</p></div>`;
        return card;
    }

    function renderCards() {
        cardContainer.innerHTML = '';
        if (currentProfiles.length === 0) {
            cardContainer.innerHTML = `<div class="text-center p-8" style="color: var(--text-secondary);"><i class="fas fa-sad-tear fa-4x"></i><h2 class="mt-4 text-xl font-bold" style="color: var(--text-primary);">No More Profiles</h2><p>Check back later for new skills!</p></div>`;
            return;
        }
        currentProfiles.slice(0, 2).reverse().forEach((profile, index) => {
            const card = createCard(profile);
            card.style.zIndex = currentProfiles.length - index;
            card.style.transform = `translateY(${index * 10}px) scale(${1 - index * 0.05})`;
            cardContainer.appendChild(card);
        });
        if (cardContainer.children.length > 0) addPanListeners(cardContainer.lastChild);
    }

    function addPanListeners(element) {
        let startX = 0, isPanning = false;
        const onPointerDown = (e) => { isPanning = true; startX = e.clientX; element.style.transition = 'none'; element.style.cursor = 'grabbing'; };
        const onPointerMove = (e) => {
            if (!isPanning) return;
            const diffX = e.clientX - startX;
            element.style.transform = `translateX(${diffX}px) rotate(${diffX / 20}deg)`;
        };
        const onPointerUp = (e) => {
            if (!isPanning) return;
            isPanning = false;
            element.style.transition = 'transform 0.4s ease';
            element.style.cursor = 'grab';
            if (Math.abs(e.clientX - startX) > 100) swipe(e.clientX > startX ? 'right' : 'left');
            else element.style.transform = '';
        };
        element.addEventListener('mousedown', onPointerDown);
        element.addEventListener('mousemove', onPointerMove);
        element.addEventListener('mouseup', onPointerUp);
        element.addEventListener('mouseleave', onPointerUp);
    }

    function swipe(direction) {
        const card = cardContainer.lastChild;
        if (!card) return;
        const profile = currentProfiles.shift();
        if (!profile) return; 

        const x = direction === 'right' ? window.innerWidth : -window.innerWidth;
        card.style.transform = `translateX(${x}px) rotate(${direction === 'right' ? 30 : -30}deg)`;
        card.style.opacity = '0';
        if (direction === 'right') {
            matches.push(profile);
            conversations[profile.id] = [
                { sender: 'them', text: `Hey! I see you're interested in learning ${profile.skill}. I'd be happy to help.` },
                { sender: 'me', text: `That's great! Thanks, ${profile.name.split(',')[0]}. When would be a good time to chat?` }
            ];
            updateConnectionsList();
        }
        setTimeout(renderCards, 300);
    }

    likeBtn.addEventListener('click', () => swipe('right'));
    nopeBtn.addEventListener('click', () => swipe('left'));
    messageNavBtn.addEventListener('click', () => navigateToPage('connections'));

    // --- NAVIGATION ---
    function navigateToPage(pageId) {
        const oldPage = document.getElementById(activePage);
        if (oldPage && oldPage.id !== pageId) {
            oldPage.classList.add('inactive-left');
        }

        activePage = pageId;
        navItems.forEach(i => i.classList.toggle('active', i.dataset.page === pageId));
        pages.forEach(p => {
            p.classList.remove('inactive-left');
            p.classList.toggle('active', p.id === pageId)
        });
    }
    navItems.forEach(item => item.addEventListener('click', () => navigateToPage(item.dataset.page)));

    // --- CONNECTIONS & CHAT ---
    const connectionsListEl = document.getElementById('connections-list');
    const chatHeaderEl = document.getElementById('chat-header');
    const chatMessagesEl = document.getElementById('chat-messages');
    const aiPlanBtn = document.getElementById('ai-plan-btn');
    const aiIcebreakerBtn = document.getElementById('ai-icebreaker-btn');

    function updateConnectionsList() {
        if (matches.length === 0) {
            connectionsListEl.innerHTML = `<div class="p-8 text-center" style="color: var(--text-secondary);">No connections yet.</div>`;
            return;
        }
        connectionsListEl.innerHTML = matches.map(match => `
            <div class="connection-item flex items-center p-3 cursor-pointer border-b hover:opacity-80" style="border-color: var(--background-light);" data-id="${match.id}">
                <img src="${match.image}" class="w-12 h-12 rounded-full mr-3">
                <div class="flex-grow overflow-hidden">
                    <p class="font-bold truncate" style="color: var(--text-primary);">${match.name.split(',')[0]}</p>
                    <p class="text-sm truncate" style="color: var(--text-secondary);">${conversations[match.id].slice(-1)[0].text}</p>
                </div>
            </div>
        `).join('');
        connectionsListEl.querySelectorAll('.connection-item').forEach(item => {
            item.addEventListener('click', () => openChat(item.dataset.id));
        });
    }

    function openChat(userId) {
        currentChatUserId = userId;
        const user = matches.find(m => m.id == userId);
        if (!user) return;
        
        navigateToPage('chat');
        
        chatHeaderEl.innerHTML = `
            <button id="back-to-connections" class="mr-3 text-xl"><i class="fas fa-chevron-left"></i></button>
            <img src="${user.image}" class="w-10 h-10 rounded-full mr-3">
            <h2 class="font-bold text-lg" style="color: var(--text-primary);">${user.name.split(',')[0]}</h2>
        `;
        
        renderMessages(userId);
        
        document.getElementById('back-to-connections').addEventListener('click', () => navigateToPage('connections'));
    }

    function renderMessages(userId) {
        chatMessagesEl.innerHTML = (conversations[userId] || []).map(msg => 
            `<div class="chat-bubble ${msg.sender === 'ai' ? 'ai-generated' : (msg.sender === 'me' ? 'sent' : 'received')}">${msg.text}</div>`
        ).join('');
        chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    // --- PROFILE CUSTOMIZATION ---
    const editBtn = document.getElementById('edit-profile-btn');
    const saveBtn = document.getElementById('save-profile-btn');
    const aiBioBtn = document.getElementById('ai-bio-btn');
    const viewElements = { name: document.getElementById('profile-name-view'), tagline: document.getElementById('profile-tagline-view'), mySkills: document.getElementById('my-skills-view'), learnSkills: document.getElementById('learn-skills-view') };
    const editElements = { name: document.getElementById('profile-name-edit'), tagline: document.getElementById('profile-tagline-edit'), mySkills: document.getElementById('my-skills-edit'), learnSkills: document.getElementById('learn-skills-edit') };

    const createTags = (csv) => csv.split(',').map(s => `<span class="tag py-1 px-3 rounded-full text-sm font-semibold">${s.trim()}</span>`).join('');

    function renderProfile() {
        viewElements.name.textContent = userProfile.name;
        viewElements.tagline.textContent = userProfile.tagline;
        viewElements.mySkills.innerHTML = createTags(userProfile.mySkills);
        viewElements.learnSkills.innerHTML = createTags(userProfile.learnSkills);
        editElements.name.value = userProfile.name;
        editElements.tagline.value = userProfile.tagline;
        editElements.mySkills.value = userProfile.mySkills;
        editElements.learnSkills.value = userProfile.learnSkills;
    }

    function toggleProfileEdit(isEditing) {
        editBtn.classList.toggle('hidden', isEditing);
        saveBtn.classList.toggle('hidden', !isEditing);
        aiBioBtn.classList.toggle('hidden', !isEditing);
        for (const key in viewElements) {
            viewElements[key].classList.toggle('hidden', isEditing);
            editElements[key].classList.toggle('hidden', !isEditing);
        }
    }

    editBtn.addEventListener('click', () => toggleProfileEdit(true));
    saveBtn.addEventListener('click', () => {
        userProfile.name = editElements.name.value;
        userProfile.tagline = editElements.tagline.value;
        userProfile.mySkills = editElements.mySkills.value;
        userProfile.learnSkills = editElements.learnSkills.value;
        renderProfile();
        toggleProfileEdit(false);
    });
    
    // --- PREMIUM & PAYMENT PAGE LOGIC ---
    const planToggle = document.getElementById('plan-toggle');
    const toggleButtons = planToggle.querySelectorAll('.toggle-btn');
    const pricingCard = document.getElementById('pricing-card');
    const yearlyBadge = document.getElementById('yearly-badge');
    const planName = document.getElementById('plan-name');
    const planPrice = document.getElementById('plan-price');
    const planStrikethrough = document.getElementById('plan-strikethrough');
    const subscribeBtn = document.getElementById('subscribe-btn');
    const paymentAmountEl = document.getElementById('payment-amount');
    const backToPremiumBtn = document.getElementById('back-to-premium');
    const paymentOptionBtns = document.querySelectorAll('.payment-option-btn');
    const upiOptions = document.getElementById('upi-options');
    const cardOptions = document.getElementById('card-options');
    const payNowBtn = document.getElementById('pay-now-btn');

    const premiumFeatures = [
        { icon: 'fas fa-chalkboard-teacher', text: 'One-on-One Mentorship' },
        { icon: 'fas fa-certificate', text: 'Official Skill Certification' },
        { icon: 'fas fa-comments', text: 'Direct Messaging Any Mentor' },
        { icon: 'fas fa-rocket', text: 'Profile Boost for More Views' },
        { icon: 'fas fa-filter', text: 'Advanced Search Filters' },
        { icon: 'fas fa-infinity', text: 'Unlimited Learning Swipes' }
    ];

    const featuresListEl = document.getElementById('features-list');
    featuresListEl.innerHTML = premiumFeatures.map(f => `
        <li class="feature-item">
            <i class="${f.icon}"></i>
            <span class="ml-4">${f.text}</span>
        </li>
    `).join('');

    function updatePricing(plan) {
        if (plan === 'monthly') {
            selectedPlan = { name: 'Monthly', price: '₹49' };
            planToggle.classList.remove('yearly-active');
            pricingCard.classList.remove('yearly-plan');
            yearlyBadge.classList.add('hidden');
            planName.textContent = 'Monthly';
            planPrice.innerHTML = `₹49<span class="text-gray-400 text-lg">/mo</span>`;
            planStrikethrough.classList.remove('hidden');
        } else { // yearly
            selectedPlan = { name: 'Yearly', price: '₹349' };
            planToggle.classList.add('yearly-active');
            pricingCard.classList.add('yearly-plan');
            yearlyBadge.classList.remove('hidden');
            planName.textContent = 'Yearly';
            planPrice.innerHTML = `₹349<span class="text-gray-400 text-lg">/yr</span>`;
            planStrikethrough.classList.add('hidden');
        }
    }

    toggleButtons.forEach(button => {
        button.addEventListener('click', () => {
            toggleButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updatePricing(button.dataset.plan);
        });
    });

    subscribeBtn.addEventListener('click', () => {
        paymentAmountEl.textContent = `Total: ${selectedPlan.price}`;
        navigateToPage('payment');
    });

    backToPremiumBtn.addEventListener('click', () => navigateToPage('premium'));

    paymentOptionBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            paymentOptionBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (btn.dataset.option === 'upi') {
                upiOptions.classList.remove('hidden');
                cardOptions.classList.add('hidden');
            } else {
                upiOptions.classList.add('hidden');
                cardOptions.classList.remove('hidden');
            }
        });
    });

    payNowBtn.addEventListener('click', () => {
        alert('Payment Successful! Welcome to Premium.');
        navigateToPage('home');
    });

    // --- GEMINI API FEATURES ---

    async function callGemini(prompt, button) {
        const originalText = button.innerHTML;
        button.disabled = true;
        button.innerHTML = '<div class="loading-spinner"></div>';
        
        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = "AIzaSyC_IzrHME1jk0EkvXAutUYZTdHtDuxz8wk"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                return "Sorry, I couldn't generate a response right now.";
            }
        } catch (error) {
            console.error("Gemini API call failed:", error);
            return "An error occurred. Please try again.";
        } finally {
            button.disabled = false;
            button.innerHTML = originalText;
        }
    }

    aiPlanBtn.addEventListener('click', async () => {
        const user = matches.find(m => m.id == currentChatUserId);
        if (!user) return;
        const prompt = `Create a concise, week-by-week learning plan for a beginner learning "${user.skill}". The plan should be encouraging and formatted with Markdown. Include a title, and for each week, provide a clear goal and 2-3 key learning points.`;
        const response = await callGemini(prompt, aiPlanBtn);
        conversations[currentChatUserId].push({ sender: 'ai', text: response.replace(/\n/g, '<br>') });
        renderMessages(currentChatUserId);
    });

    aiIcebreakerBtn.addEventListener('click', async () => {
        const user = matches.find(m => m.id == currentChatUserId);
        if (!user) return;
        const prompt = `Suggest three short, friendly, and distinct icebreaker messages for a user who wants to learn "${user.skill}" from a mentor named ${user.name.split(',')[0]}. The tone should be enthusiastic but respectful. Format the response as a simple list with each message on a new line.`;
        const response = await callGemini(prompt, aiIcebreakerBtn);
        conversations[currentChatUserId].push({ sender: 'ai', text: response.replace(/\n/g, '<br>') });
        renderMessages(currentChatUserId);
    });
    
    aiBioBtn.addEventListener('click', async () => {
        const prompt = `Generate a professional and engaging user profile for a skill-sharing app. The user's name is ${userProfile.name}. They can teach "${userProfile.mySkills}" and want to learn "${userProfile.learnSkills}". Provide a short, catchy tagline (1 sentence) and a brief bio (2-3 sentences). Format it as: Tagline: [tagline] Bio: [bio]`;
        const response = await callGemini(prompt, aiBioBtn);
        const taglineMatch = response.match(/Tagline: (.*)/);
        const bioMatch = response.match(/Bio: (.*)/);
        if (taglineMatch && bioMatch) {
            editElements.tagline.value = taglineMatch[1];
            // A simple way to update the bio in the UI - you might want a dedicated text area
            alert(`Generated Bio:\n\n${bioMatch[1]}\n\n(This has been copied to your clipboard if you'd like to paste it elsewhere)`);
        } else {
            alert(response);
        }
    });


    // --- INITIAL LOAD ---
    renderCards();
    updateConnectionsList();
    renderProfile();
    updatePricing('monthly');
});
</script>

</body>
</html>
